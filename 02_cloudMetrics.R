#setwd('/home/gorgens/Documents/R julia pibic/')
require(lidR)
require(data.table)


ctg = readLAScatalog("./2017/norm/")
opt_output_files(ctg) = "./2017/plot/plot2017{ID}"
opt_filter(ctg) = "-drop_z_below 0"

# # Pontos transectos 
# utmx = c(778213.068,
# 778817.252,
# 779959.721,
# 779892.606,
# 780688.754,
# 780514.903,
# 779054.556,
# 779533.315,
# 780494.398,
# 778634.64,
# 779460.208,
# 778939.547,
# 778833.454,
# 779459.317,
# 780117.275,
# 780806.438,
# 780796.631,
# 779089.326,
# 779795.428,
# 780330.354,
# 778841.478,
# 779938.075)
# 
# utmy = c(9586851.835,
# 9585339.165,
# 9586538.227,
# 9586173.066,
# 9587055.693,
# 9585538.288,
# 9584983.748,
# 9584911.533,
# 9584927.581,
# 9583839.899,
# 9584151.939,
# 9586864.903,
# 9586262.22,
# 9586732.955,
# 9585502.626,
# 9586583.176,
# 9585955.53,
# 9584549.567,
# 9584553.133,
# 9584533.519,
# 9583971.847,
# 9584062.785)

#Pontos parcelas 50x50
utmx = c(778433.368,
778281.949,
778135.635,
777983.366,
779042.566,
778895.401,
778749.086,
778594.265,
780164.989,
780016.123,
779863.854,
779717.539,
780132.664,
779988.051,
779835.782,
779685.214,
780671.454,
780666.35,
780681.662,
780690.169,
780571.84,
780523.069,
780473.163,
780427.794,
779038.574,
779040.843,
779036.306,
779032.903,
779520.618,
779514.947,
779520.618,
779524.021,
780472.732,
780479.537,
780479.537,
780486.343,
778640.965,
778646.636,
778646.636,
778645.502,
779250.609,
779403.729,
779546.641,
779699.76,
778951.175,
778952.309,
778952.309,
778952.309,
779056.657,
778908.074,
778764.028,
778623.385,
779209.777,
779350.42,
779499.003,
779648.721,
780129.63,
780130.764,
780133.033,
780135.301,
780786.344,
780809.028,
780831.713,
780852.129,
780781.807,
780786.344,
780790.881,
780806.76,
779116.803,
779107.729,
779107.729,
779109.997,
779810.946,
779808.677,
779806.409,
779808.677,
780307.734,
780334.956,
780349.701,
780372.385,
778847.992,
778852.529,
778852.529,
778850.261,
780148.944,
780009.434,
779863.12,
779734.953)

utmy = c(9586883.921,
9586872.863,
9586862.655,
9586845.642,
9585335.653,
9585349.263,
9585362.874,
9585374.783,
9586557.662,
9586552.558,
9586545.752,
9586542.35,
9586168.057,
9586181.667,
9586190.174,
9586198.681,
9587264.239,
9587114.522,
9586959.701,
9586806.581,
9585749.639,
9585613.533,
9585469.487,
9585319.769,
9585188.952,
9585031.295,
9584883.846,
9584736.397,
9585129.972,
9584980.255,
9584833.94,
9584683.089,
9585142.812,
9585002.168,
9584843.378,
9584689.124,
9583603.674,
9583749.989,
9583907.645,
9584056.228,
9584133.922,
9584137.325,
9584146.399,
9584148.667,
9586619,
9586765.315,
9586917.3,
9587065.883,
9586275.331,
9586275.331,
9586276.465,
9586281.002,
9586756.241,
9586738.093,
9586710.872,
9586688.188,
9585268.143,
9585423.531,
9585573.249,
9585721.832,
9586360.398,
9586505.578,
9586653.027,
9586795.939,
9586151.701,
9585997.447,
9585854.535,
9585702.55,
9584306.306,
9584458.291,
9584605.74,
9584755.457,
9584313.111,
9584465.096,
9584612.545,
9584762.262,
9584308.574,
9584457.157,
9584600.069,
9584756.591,
9583735.793,
9583884.375,
9584030.69,
9584182.676,
9584141.844,
9584099.877,
9584057.911,
9584013.677)

r = 20

plots_ALS_clipped = clip_circle(ctg, utmx, utmy, r)

opt_independent_files(plots_ALS_clipped) = TRUE
opt_output_files(plots_ALS_clipped) = ""
plots_metrics = catalog_apply(plots_ALS_clipped, cloud_metrics, func = .stdmetrics_z)
plots_metrics = data.table::rbindlist(plots_metrics)
write.csv(plots_metrics, './2017/metrics2017_06042021.csv')
